name: 'Logic App Standard Release'

trigger: none
     
variables:
  Artifacts.Location.Deploy.Bicep: $(System.DefaultWorkingDirectory)/deploy/bicep
  Artifacts.Location.Deploy.Scripts: $(System.DefaultWorkingDirectory)/deploy/scripts
  Artifacts.Location.Source: $(System.DefaultWorkingDirectory)/src

stages:
- stage: Sandbox
  displayName: Sandbox
  variables:
    - template: ../lib/environment/sandbox.yml
    - template: ../lib/general/azure.yml
  jobs: 
  - deployment: Sandbox
    displayName: Sandbox
    pool:
      vmImage: "windows-latest"
    environment: Sandbox
    strategy:
      runOnce:
        deploy:
          - template: templates/logic-app-standard/release_stageSteps.yml
            parameters:
              azureServiceConnection: 'Visual Studio Enterprise-abonnement – MPN'
              location: '$(Environment.Region.Primary)'
              environment: '$(Environment.ShortName)'
              resourceGroupName: '$(ResourceGroup.LogicAppStandard)'
      
- stage: DEV
  displayName: DEV
  dependsOn: [Sandbox]
  condition: and(ne(variables['Build.Reason'], 'PullRequest'), succeeded())
  variables:
    - template: ../lib/environment/dev.yml
    - template: ../lib/general/azure.yml
  jobs: 
  - deployment: DEV
    displayName: DEV
    pool:
      vmImage: "windows-latest"
    environment: DEV
    strategy:
      runOnce:
        deploy:
          - template: templates/logic-app-standard/release_stageSteps.yml
            parameters:
              azureServiceConnection: 'Visual Studio Enterprise-abonnement – MPN'
              location: '$(Environment.Region.Primary)'
              environment: '$(Environment.ShortName)'
              resourceGroupName: '$(ResourceGroup.LogicAppStandard)'